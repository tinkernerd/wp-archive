---
import Layout from "@/layouts/Layout.astro";
import { getAlbumImages, getAlbums } from "@/utils/r2";

export const prerender = true; // Ensure static generation

export async function getStaticPaths() {
  const albums = await getAlbums(); // Dynamically fetch album names
  return albums.map((album: string) => ({ params: { album } }));
}

const { album } = Astro.params;
let images = await getAlbumImages(album);
const albums = await getAlbums(); // Fetch albums for navigation

// Filter out unwanted files like .DS_Store and README.md
images = images.filter(image => !image.includes(".DS_Store") && !image.includes("README.md"));

const title = album.replace(/[-_]/g, ' ').replace(/\b\w/g, (char: string) => char.toUpperCase());

// Find previous and next albums in alphabetical order
const sortedAlbums = albums.sort();
const currentIndex = sortedAlbums.indexOf(album);
const prevAlbum = currentIndex > 0 ? sortedAlbums[currentIndex - 1] : null;
const nextAlbum = currentIndex < sortedAlbums.length - 1 ? sortedAlbums[currentIndex + 1] : null;
---

<Layout title={title} description={`Download high-quality wallpapers from the ${title} album.`}>
  <section class="max-w-screen-lg mx-auto px-6 py-16">
    <div class="flex justify-between items-center mb-6">
      {prevAlbum && <a href={`/${prevAlbum}`} class="text-lg text-gray-500 hover:text-gray-700">⬅ {prevAlbum.replace(/[-_]/g, ' ').replace(/\b\w/g, (char) => char.toUpperCase())}</a>}
      <h2 class="text-3xl font-semibold text-center text-theme-text">{title} Wallpaper Album</h2>
      {nextAlbum && <a href={`/${nextAlbum}`} class="text-lg text-gray-500 hover:text-gray-700">{nextAlbum.replace(/[-_]/g, ' ').replace(/\b\w/g, (char) => char.toUpperCase())} ➡</a>}
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"> <!-- Adjusted grid for wider images -->
      {images.map((image: string) => (
        <a href={image} class="group block relative rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition" target="_blank" rel="noopener noreferrer">
          <img src={image} alt={image.split("/").pop()} class="w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300" /> <!-- Increased height for better aspect ratio -->
        </a>
      ))}
    </div>
  </section>
</Layout>